bash -lc 'p=$(sudo -Hiu root env | awk -F= "/^PATH=/ {print \$2; exit}"); echo "root PATH=$p"; issues=0; [[ "$p" == *"::"* ]] && echo "ISSUE: empty PATH element (::)" && issues=1; [[ "$p" == *: ]] && echo "ISSUE: trailing colon" && issues=1; printf "%s\n" "$p" | grep -qE "(^|:)\.(:|$)" && echo "ISSUE: contains current directory (.)" && issues=1; IFS=":"; for d in $p; do [ -z "$d" ] && continue; if [ ! -d "$d" ]; then echo "ISSUE: not a directory: $d"; issues=1; continue; fi; owner=$(stat -c %U "$d" 2>/dev/null || echo "?"); mode=$(stat -c %a "$d" 2>/dev/null || echo "000"); [ "$owner" != "root" ] && echo "ISSUE: not owned by root: $d owner=$owner" && issues=1; if (( (8#$mode) & 022 )); then echo "ISSUE: permissions too permissive: $d mode=$mode" && issues=1; fi; done; if [ $issues -eq 0 ]; then echo "PASS: root PATH OK"; else echo "FAIL: issues found"; fi'
